- name: run nginx on SlaveDevice
  hosts: SlaveDevice
  roles:
    - { role: ../../nginx, nginx_client_facts: no, nginx_server_facts: true}

- hosts: MasterDevice
  tasks:
    - name: remove latest data
      file:
        path: /tmp/nginx_output.log
        state: absent

    - name: run nginx
      shell: "/tmp/nginx/install/bin/httpress -n 10000 -c 100 -t 4 http://{{ groups['SlaveDevice'][0] }}/index.html >> /tmp/nginx_output.log"

    - name: fetch result
      fetch:
        src: /tmp/nginx_output.log
        dest: /tmp/nginx_output.log
        flat: yes

    - name: del nginx on client
      shell: "rm -rf /tmp/nginx"
      become: true
      become_method: sudo
      become_user: root

- hosts: SlaveDevice
  tasks:
    - name: del nginx on server
      shell: "rm -rf /tmp/nginx/"
      become: true
      become_method: sudo
      become_user: root


