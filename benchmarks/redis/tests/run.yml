---
- hosts: Device
  tasks:
    - name: remove latest data
      file:
        path: /tmp/redis_output.log
        state: absent
      become: true
      become_method: sudo
      become_user: root
    
    - name: create {{ home }}/caliper_output/caliper/benchmarks/redis/
      file: path=/tmp/redis/  state="directory"

    - name: copy redis
      copy:
        src: "~/caliper_output/caliper/benchmarks/redis/"
        dest: "/tmp/redis/"
        mode: 0755
        backup: yes
 
    - name: test redis benchmark on client
      shell: "/tmp/redis/run_client.sh {{ groups['TestNode'][0] }}"
      ignore_error: yes                        
      become: true
      become_method: sudo
      become_user: root

    - name: fetch result
      fetch:
        src: /tmp/redis_output.log
        dest: /tmp/redis_output.log 
        flat: yes
      become: true
      become_method: sudo
      become_user: root

    - name: del redis on client
      shell: "rm -rf /tmp/redis/"
      become: true
      become_method: sudo
      become_user: root



