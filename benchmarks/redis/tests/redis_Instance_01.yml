---
- hosts: MasterDevice
  tasks:
    - name: remove latest data
      file:
        path: /tmp/redis_output.log
        state: absent
      become: true
      become_method: sudo
      become_user: root
    
    - name: create ~/caliper_output/caliper/benchmarks/redis/
      file: path=/tmp/redis/  state="directory"
 
    - name: test redis benchmark on client
      shell: "/tmp/redis/files/run_client.sh {{ groups['SlaveDevice'][0] }}"
      ignore_error: yes                        
      become: true
      become_method: sudo
      become_user: root

    - name: fetch result
      fetch:
        src: /tmp/redis_output.log
        dest: /tmp/redis_output.log 
        flat: yes
      become: true
      become_method: sudo
      become_user: root

    - name: del redis on client
      shell: "rm -rf /tmp/redis/"
      become: true
      become_method: sudo
      become_user: root

- hosts: SlaveDevice
  tasks:
    - name: stop redis-server
      shell: "/etc/init.d/redis-server stop"
      become: true
      become_method: sudo
      become_user: root
      ignore_error: yes                        

    - name: stop redis-sentinel 
      shell: "/etc/init.d/redis-sentinel stop"
      become: true
      become_method: sudo
      become_user: root
      ignore_error: yes
              
    - name: stop redis-server
      shell: "killall -9 redis-server"
      become: true
      become_method: sudo
      become_user: root
      ignore_error: yes                        
